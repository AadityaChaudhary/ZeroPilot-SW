##########################################################################################################################
# File automatically-generated by tool: [projectgenerator] version: [2.25.0] date: [Tue Oct 03 20:22:25 EDT 2017] 
##########################################################################################################################

# ------------------------------------------------
# Generic Makefile (based on gcc)
#
# ChangeLog :
#	2017-02-10 - Several enhancements + project update mode
#   2015-07-22 - first version
# ------------------------------------------------

######################################
# target
######################################
TARGET = Autopilot


######################################
# building variables
######################################
# debug build?
DEBUG = 1
# optimization
OPT = -Og


#######################################
# paths
#######################################
ROOT_DIR 		= ./..
PROJECT_DIR 	= $(ROOT_DIR)/$(TARGET)

# Build path
BUILD_DIR 		= $(PROJECT_DIR)/build
HAL_DIR 		= $(PROJECT_DIR)/Drivers/STM32F7xx_HAL_Driver

FREERTOS_DIR 	= $(PROJECT_DIR)/Middlewares/Third_Party/FreeRTOS/Source
PERIPH_DIR 		= $(PROJECT_DIR)/Drivers/Peripherals

######################################
# source
######################################
FREERTOS_SOURCES = \
$(FREERTOS_DIR)/portable/GCC/ARM_CM7/r0p1/port.c \
$(FREERTOS_DIR)/portable/MemMang/heap_4.c \
$(FREERTOS_DIR)/CMSIS_RTOS/cmsis_os.c \
$(FREERTOS_DIR)/tasks.c \
$(FREERTOS_DIR)/timers.c \
$(FREERTOS_DIR)/event_groups.c \
$(FREERTOS_DIR)/queue.c \
$(FREERTOS_DIR)/list.c \
$(FREERTOS_DIR)/croutine.c \

HAL_SOURCES = $(wildcard $(HAL_DIR)/Src/*.c)
# $(wildcard $(PROJECT_DIR)/Drivers/CMSIS/DSP_Lib/Source/*/*.c)

PERI_SOURCES = $(wildcard $(PERIPH_DIR)/Src/*.c)

MAIN_SOURCES = $(wildcard $(PROJECT_DIR)/Src/*.c)

C_SOURCES = \
$(FREERTOS_SOURCES) \
$(HAL_SOURCES) \
$(PERI_SOURCES) \
$(MAIN_SOURCES) \

# ASM sources
ASM_SOURCES =  \
$(PROJECT_DIR)/startup_stm32f765xx.s

#######################################
# CFLAGS
#######################################
# cpu
CPU = -mcpu=cortex-m7

# fpu
FPU = -mfpu=fpv5-d16

# float-abi
FLOAT-ABI = -mfloat-abi=hard

# mcu
MCU = $(CPU) -mthumb $(FPU) $(FLOAT-ABI)

# macros for gcc
# AS defines
AS_DEFS =

# C defines
C_DEFS =  \
-DUSE_HAL_DRIVER \
-DSTM32F7xx \
-DSTM32F765xx \
-DARM_MATH_CM7 \

# AS includes
AS_INCLUDES =  \
-I$(PROJECT_DIR)/Inc

# C includes
C_INCLUDES =  \
-I$(PROJECT_DIR)/Drivers/CMSIS/Device/ST/STM32F7xx/Include \
-I$(FREERTOS_DIR)/portable/GCC/ARM_CM7/r0p1 \
-I$(FREERTOS_DIR)/include \
-I$(FREERTOS_DIR)/CMSIS_RTOS \
-I$(PERIPH_DIR)/Inc \

#######################################
# LDFLAGS
#######################################
# link script
LDSCRIPT = $(PROJECT_DIR)/STM32F765ZGTx_FLASH.ld

# libraries
LIBS = -lc -lm -lnosys -larm_cortexM7lfdp_math
LIBDIR = -L$(PROJECT_DIR)/Drivers/CMSIS/Lib/GCC/
LDFLAGS = $(MCU) -specs=nano.specs -T$(LDSCRIPT) $(LIBDIR) $(LIBS) -Wl,-Map=$(BUILD_DIR)/$(TARGET).map,--cref -Wl,--gc-sections

include $(ROOT_DIR)/project.mk

# *** EOF ***
